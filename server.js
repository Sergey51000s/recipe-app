const express = require('express');
const cors = require('cors');
const path = require('path');
const app = express();

app.use(cors());
// Убедимся, что статические файлы (public) отдаются только для корневого пути
app.use(express.static(path.join(__dirname, 'public')));

// Определяем маршруты для API перед статическими файлами
const dishes = {
  Салаты: {
    'Греческий': { ingredients: 'Помидоры, огурцы, перец болгарский, лук красный, сыр фета, маслины, оливки, оливковое масло, лимон' },
    'Цезарь с курицей': { ingredients: 'Куриное филе, салат Айсберг, сухарики из белого хлеба, сыр Пармезан, яйцо перепелиное, соус Цезарь, помидоры Черри, соль, перец' },
    'Цезарь с креветками': { ingredients: 'Салат Айсберг, сыр Пармезан, сухарики из белого хлеба, соус Цезарь, помидоры черри, креветки тигровые, масло подсолнечное, яйцо перепелиное, соль, перец' }
  },
  Супы: {
    'Куриный': { ingredients: 'Курица, лапша яичная, морковь, лук репчатый, бульон готовый куриный, вода, зелень, яйцо куриное, соль, перец' },
    'Грибной крем-суп': { ingredients: 'Шампиньоны, картофель, лук репчатый, сливки 20%, масло сливочное, чеснок, сухари из белого хлеба, куриный бульон, мука пшеничная' },
    'Том Ям': { ingredients: 'Паста Том Ям, куриный бульон, креветки тигровые, кальмар очищенный, мидии очищенные, шампиньоны, помидоры черри, кокосовое молоко, рис' }
  },
  Горячее: {
    'Стейк из сёмги с картофельным пюре': { ingredients: 'Лосось (стейк), лимон, оливковое масло, специи, картофель, сливочное масло, соль' },
    'Куриная котлета с картофельным пюре': { ingredients: 'Фарш куриный, лук репчатый, хлеб, молоко, яйцо, масло растительное, картофель, масло сливочное' },
    'Бургер с говядиной и картошкой фри': { ingredients: 'Булочки для гамбургера с кунжутом, котлета говяжья п/ф, сыр Чеддер, помидор свежий, лук красный, огурец соленый, салат Айсберг, бекон, соус Бургер готовый, масло растительное, соль/перец, картофель фри с/м' }
  },
  Паста: {
    'Карбонара': { ingredients: 'Спагетти, бекон, яичный желток, сыр Пармезан, чеснок, свежемолотый черный перец, соль поваренная пищевая' },
    'Фетучини с курицей и грибами': { ingredients: 'Паста фетучини, филе куриное, шампиньоны свежие, сливки 20%, лук репчатый, чеснок, масло растительное, сыр Пармезан, соль пищевая, перец душистый свежемолотый' },
    'Фарфале с сёмгой': { ingredients: 'Паста фарфалле, филе семги, сливки 20%, шпинат свежий, чеснок, лук репчатый, лимон, сыр Пармезан, оливковое масло, соль, перец' },
    'Паста с креветками': { ingredients: 'Спагетти, креветки очищенные, чеснок, оливковое масло, белое вино сухое, сливки 20%, лимон, Пармезан (тертый), петрушка, соль пищевая' }
  },
  Закуски: {
    'Сырные палочки с брусничным соусом': { ingredients: 'Сырные палочки с/м, масло д/фритюра, соус брусничный готовый' },
    'Картошка фри': { ingredients: 'Картофель фри с/м, масло д/фритюра, трюфельное масло, соль, соус' },
    'Стрипсы куриные с соусом барбекю': { ingredients: 'Стрипсы с/м, масло д/фритюра, соус барбекю готовый, лимон' },
    'Нагетсы куриные с сырным соусом': { ingredients: 'Нагеттсы с/м, масло д/фритюра, соус сырный готовый, лимон' },
    'Креветки темпура с соусом терияки': { ingredients: 'Креветки тигровые, мука темпура, ледяная вода, яйцо охлажденное, масло д/фритюра, соль, соус терияки' }
  }
};

// API-роут для получения списка блюд по категории
app.get('/api/dishes/:category', (req, res) => {
  const category = req.params.category;
  if (dishes[category]) {
    res.json(dishes[category]);
  } else {
    res.status(404).json({ error: 'Категория не найдена' });
  }
});

// Обработка корневого пути
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`Сервер запущен на порту ${port}`);
});